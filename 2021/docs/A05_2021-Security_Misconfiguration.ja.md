# A05:2021-セキュリティの設定ミス

## 因子

| 対応する CWE 数 | 最大発生率 | 平均発生率 | 最大網羅率 | 平均網羅率 | 加重平均（攻撃の難易度） | 加重平均（攻撃による影響） | 総発生数 | CVE 合計件数 |
|:-------------:|:--------------------:|:--------------------:|:--------------:|:--------------:|:----------------------:|:---------------------:|:-------------------:|:------------:|
| 20          | 19.84%             | 4.51%              | 89.58%       | 44.84%       | 8.12                 | 6.56                | 208,387           | 789        |

## 概要

前回の 6 位から順位を上げました。アプリケーションの 90 ％には何らかの設定ミスが見られます。
高度な設定が可能なソフトウェアへの移行が進む中で、このカテゴリーの順位が上がったことは当然と言えます。
注目すべき CWE は *CWE-16 設定の問題* と *CWE-611 外部に置かれたファイルを呼び出す XXE (Xml eXternal Entity) 問題* です。

## 説明

アプリケーションが下記のようなら、恐らく脆弱です:

-   アプリケーションスタックのいずれかの部分におけるセキュリティ堅牢化の不足、あるいはクラウドサービスでパーミッションが不適切に設定されている。

-   必要のない機能が有効、あるいはインストールされている(例えば、必要のないポートやサービス、ページ、アカウント、特権)。

-   デフォルトのアカウントとパスワードが有効になったまま変更されていない。

-   エラー処理がユーザに対して、スタックトレースやその他余計な情報を含むエラーメッセージを見せる。

-   アップグレードしたシステムでは、最新のセキュリティ機能が無効になっているか正しく設定されていない。

-   アプリケーションサーバやアプリケーションフレームワーク(例えば、Struts、Spring、 ASP.NET)、ライブラリ、データベース等のセキュリティの設定が、安全な値に設定されていない。

-   サーバがセキュリテイヘッダーやディレクティブを送らなかったり、安全な値に設定されていなかったりする。

-   ソフトウェアが古いか脆弱である。(# A06:2021 – 脆弱で古くなったコンポーネント を参照)

アプリケーションのセキュリティを設定するプロセスを協調して繰り返すことができなければ、システムはより高いリスクにさらされます。

## 防止方法

安全にインストールするプロセスにおいて、以下のことを実施すべきです:

-   繰り返し堅牢化するプロセスは、素早くかつ容易に他の環境に展開され、正しくロックダウンすること。
    開発やQA、本番環境は完全に同じように設定し、それぞれの環境で別々の認証情報を使用すること。
    このプロセスを自動化し、新しい安全な環境をセットアップする際には、手間を最小限にすること。

-   プラットフォームは最小限のものとし、必要のない機能やコンポーネント、ドキュメント、サンプルを除くこと。
    使用しない機能とフレームワークは、削除もしくはインストールしないこと。

-   レビューを実施して、セキュリティ関連の記録と更新の全てに加え、パッチを管理するプロセスの一環としてパッチの設定を適切に更新すること(# A09:2021 – セキュリティログとモニタリングの失敗 を参照)。
    クラウドストレージのパーミッションは、詳細にレビューすること (例えば、S3 バケットのパーミッション)。

-   セグメント化したアプリケーションアーキテクチャは、セグメンテーションやコンテナリゼーション、クラウドのセキュリティグループ(ACL)をともなったコンポーネントやテナント間に、効果的で安全な仕切りをもたらす。

-   セキュリティディレクティブをクライアントへ送ること。例としては セキュリティヘッダー が挙げられる。

-   プロセスを自動化して設定の有効性を検証し、環境すべてに適用すること。

## 攻撃シナリオの例

**シナリオ #1:** 

アプリケーションのサンプルが付属しているアプリケーションサーバであるにもかかわらず、プロダクションサーバからサンプルが削除されていません。
このサンプルアプリケーションには、攻撃者がサーバに侵入する際によく使う既知の脆弱性があります。
そのアプリケーションが管理用のコンソールでデフォルトのアカウントが変更されていないと、攻撃者はデフォルトのパスワードを使ってログインし、乗っ取ってしまいます。

**シナリオ #2:** 

ディレクトリリスティングがサーバ上で無効になっていません。攻撃者はそれを見つけ出し、やすやすとディレクトリを表示してしまいます。
攻撃者はコンパイル済みのJavaクラスを見つけてダウンロードし、デコンパイルしてからリバースエンジニアリングしてコードを見ます。
そして攻撃者は、そのアプリケーションの深刻なアクセス制御上の穴を見つけます。

**シナリオ #3:** 

アプリケーションサーバの設定が、詳細なエラーメッセージ(例えば、スタックトレース)をユーザに返すようになっています。
これによって機微な情報や脆弱であるとされているコンポーネントのバージョンといった潜在的な欠陥がさらされる恐れがあります。

**シナリオ #4:** 

クラウドサービスプロバイダは、他のCSPユーザによるデフォルトでインターネットに公開された共有パーミッションを用意しています。
こうなると、機微な情報がクラウドストレージに保存され、アクセスされてしまいます。

## 参考資料

-   [OWASP Testing Guide: Configuration
    Management](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/README)

-   OWASP Testing Guide: Testing for Error Codes

-   Application Security Verification Standard V19 Configuration

-   [NIST Guide to General Server
    Hardening](https://csrc.nist.gov/publications/detail/sp/800-123/final)

-   [CIS Security Configuration
    Guides/Benchmarks](https://www.cisecurity.org/cis-benchmarks/)

-   [Amazon S3 Bucket Discovery and
    Enumeration](https://blog.websecurify.com/2017/10/aws-s3-bucket-discovery.html)

## 対応する CWE のリスト

CWE-2 環境設定

CWE-11 ASP.NET における設定ミス: デバッグバイナリの作成

CWE-13 ASP.NET における設定ミス: パスワードが設定ファイルに格納されている問題

CWE-15 システムやコンフィグレーション設定の外部制御

CWE-16 設定の問題

CWE-260 パスワードが設定ファイルに格納されている問題

CWE-315 クッキーへの機密情報の平文保存

CWE-520 .NET における設定ミス: 偽装の使用

CWE-526 環境変数による機密情報の暴露

CWE-537 機密情報を含む Java ランタイムエラーメッセージ

CWE-541 インクルードファイルへの機密情報の取り込み

CWE-547 ハードコードされたセキュリティ関連の定数の使用

CWE-611 外部に置かれたファイルを呼び出す XXE (Xml eXternal Entity) 問題

CWE-614 'Secure' 属性のない HTTPS セッションにおける機密性の高いクッキー

CWE-756 カスタムエラーページが表示されない問題

CWE-776 適切でない再帰的なエンティティ参照制限 (XML Entity Expansion) 問題

CWE-942 過剰に許可されたクロスドメイン・ホワイトリスト

CWE-1004 'HttpOnly' フラグのない 機密性の高いクッキー

CWE-1032 OWASP Top Ten 2017 Category A6 - 不適切なセキュリティ設定

CWE-1174 ASP.NET における設定ミス: 不適切なモデル検証

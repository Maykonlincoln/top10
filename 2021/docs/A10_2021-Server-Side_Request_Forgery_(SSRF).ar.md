# A10:2021 – تزوير الطلبات من جانب الخادم SSRF

## العوامل

| ربطها مع CWEs | الحد الأقصى للحدوث | متوسط معدل الحدوث | التغطية القصوى | متوسط معدل التغطية | متوسط استغلال الثغرات | متوسط التأثير | إجمالي التكرار | إجمالي نقاط الضعف CVEs |
|---------------|--------------------|-------------------|----------------|--------------------|-----------------------|---------------|----------------|------------------------|
| 1             | 2.72%              | 2.72%             | 67.72%         | 67.72%             | 8.28                  | 6.72          | 9,503          | 385                    |



## نظرة عامة

حيث تظهر البيانات ان معدل الحوادث كان منخفض نسبياً مع ان نسبة الاختبار كانت فوق المتوسط وان معدل الاختراق واثارة ستكون اعلى من المتوسط 
ومن المحتمل أن تكون هناك مجموعة مساهمات صغيرة أو فردية لهذا التصنيف في CWEs وذلك من أجل رفع الوعي، لذا نأمل ان يتم التركيز عليها وان يتم وإدراجها ضمن تصنيف أكبر في الإصدارات المقبلة.

## الوصف 

يتم تزوير طلبات الخادم عندما يقوم تطبيق الويب بجلب موارد عن بعد دون التحقق من صحة العنوان المقدم من قبل المستخدم. حيث يسمح ذلك للمهاجم بإجبار التطبيق على إرسال طلب معدل إلى وجهة غير متوقعة للخادم، حتى عندما يكون محمي بجدار حماية، شبكة خاصة افتراضية VPN أو أية نوع من قائمة التحكم بالوصول إلى الشبكة.

نظرًا لأن تطبيقات الويب (الموقع) الحديثة توفر للمستخدمين ميزات متقدمة، فإن جلب العناوين من الخادم يصبح سيناريو شائعًا. نتيجة لذلك، فإن معدل حدوث تزوير لطلبات الخادم آخذ في الازدياد. أيضًا، لذلك أصبحت استغلال هذه الثغرة اشد خطورة على الخادم بسبب الخدمات السحابية وتعقيد البنية المعمارية.

## كيفية الحماية منها 

يستطيع المطورين منع تزوير طلبات الخادم بتنفيذ بعض أو كل وسائل الدفاع التالية في ضوابط الدفاع العميق (defense in depth) :
## **من خلال طبقات الشبكة**

-   تقسيم وظائف الوصول إلى الموارد عن بعد في شبكات منفصلة لتقليل تأثير تزوير طلبات الخادم.

-   فرض سياسات جدار الحماية "الرفض افتراضيًا" أو ضبط آليات التحكم في الوصول إلى الشبكة لحظر جميع حركات مرور للشبكة الداخلية باستثناء حركة المرور الأساسية.

## **من خلال طبقات التطبيقات**

-   تصفية والتحقق من صحة جميع بيانات الإدخال المقدمة من قبل المستخدم.

-   استخدام عناوين محددة في الروابط URL، وكذلك استخدم منافذ محددة مع تحديد قائمة من العناوين محددة مسبقاً في قائمة مسموح بها.

-   لا تقم برد الطلبات للعميل على شكل بيانات خام

-   قم بتعطيل اعادة التوجيهة الى HTTP.

-   كن على حذر من هجمات اعادة الترتيب الرابط او الاحرف والتي قد تأتي في بعض الهجمات من خلال برتوكول DNS او من خلال استخدام TOCTOU.

لا تقم بتخفيف المخاطر على هجمات SSRF من خلال استخدام سياسة المنع المبنية على قائمة التعبيرات المنطقية او (regular expression). حيث ان المهاجمين لديهم قوائم معدة مسبقاً ومتعددة لمحاولة تخطي عمليات الحجب تلك.

## أمثلة على سيناريوهات الهجوم

يستطيع المهاجمين استخدام تزوير طلبات الخادم لمهاجمة الأنظمة المحمية خلف جدران حماية تطبيقات الويب(WAF)، وجدران الحماية أو قائمة التحكم للوصول للشبكة باستخدام سيناريو مثل:

**سيناريو #1:** فحص المنافذ للخوادم الداخلية في معمارية الشبكة:
الشبكات الغير مقسمة بشكل جيد تمكن المهاجمين من رسم الشبكات الداخلية بشكل دقيق ويصل الى تمكين المهاجم لمعرفة في حال كانت المنافذ مفتوحة ام مغلقة للخوادم والخدمات الداخلية من خلال دراسة اما استجابة الخادم لطلبات او من خلال الوقت المستغرق لكل طلب على كل منفذ مختلف وذلك لمعرفة في حال كان استغلال SSRF نجح ام فشل.

**سيناريو #2:** بيانات حساسة غير محمية والتي يستطيع المهاجم الوصول لها:
يستطيع المهاجم الوصول للبيانات الحساسة الداخلية مثل ملف (  file:///etc/passwd)او حتى للخدمات الداخلية من خلال استغلال هذه الثغرة

**سيناريو #3:** الوصول إلى تخزين البيانات الوصفية للخدمات السحابية :
يمتلك معظم موفري السحابة تخزين البيانات الوصفية مثل http://169.254.169.254    ويمكن للمهاجم قراءة تلك البيانات الوصفية للحصول على معلومات حساسة منها.

**سيناريو #4:** اختراق الخدمات الداخلية وإساءة استخدامها من قبل المهاجم:
يمكن للمهاجم إساءة استخدام الخدمات الداخلية لإجراء مزيد من الهجمات مثل تنفيذ التعليمات البرمجية عن بُعد (RCE) أو هجوم حجب الخدمة (DoS).

## المصادر

-   [OWASP - Server-Side Request Forgery Prevention Cheat
    Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html)

-   [PortSwigger - Server-side request forgery
    (SSRF)](https://portswigger.net/web-security/ssrf)

-   [Acunetix - What is Server-Side Request Forgery
    (SSRF)?](https://www.acunetix.com/blog/articles/server-side-request-forgery-vulnerability/)

-   [SSRF
    bible](https://cheatsheetseries.owasp.org/assets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet_SSRF_Bible.pdf)

-   [A New Era of SSRF - Exploiting URL Parser in Trending Programming
    Languages!](https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf)

## قائمة الربط مع إطار CWEs

CWE-918 Server-Side Request Forgery (SSRF)
